def make_examples(root):
    examples = []

    for lang in os.listdir(root):
        lang_path = os.path.join(root, lang)
        if not os.path.isdir(lang_path):
            continue

        dlg_dir = os.path.join(lang_path, "Dialogues")
        sum_dir = os.path.join(lang_path, "Summary_Text")
        qna_dir = os.path.join(lang_path, "QnA")

        # --- Summarization ---
        if os.path.isdir(dlg_dir) and os.path.isdir(sum_dir):
            for fn in os.listdir(dlg_dir):
                if not fn.endswith(".jsonl"):
                    continue
                dlg_path = os.path.join(dlg_dir, fn)

                dialogues = []
                for x in read_jsonl(dlg_path):
                    try:
                        if isinstance(x, dict):
                            val = x.get("dialogue", "")
                        else:
                            val = str(x)
                        if isinstance(val, list):
                            val = " ".join(map(str, val))
                        dialogues.append(str(val))
                    except Exception as e:
                        print(f"⚠️ Skipped malformed dialogue line in {fn}: {e}")
                        continue

                dialogue_text = "\n".join(dialogues).strip()
                if not dialogue_text:
                    continue

                sum_path = os.path.join(sum_dir, fn.replace(".jsonl", "_summary.txt"))
                if os.path.exists(sum_path):
                    try:
                        with open(sum_path, "r", encoding="utf-8") as f:
                            summary = f.read().strip()
                        if summary:
                            prompt = (
                                f"Summarize the following doctor–patient dialogue in English:\n"
                                f"{dialogue_text}\nSummary:"
                            )
                            examples.append({"text": prompt, "labels": summary})
                    except Exception as e:
                        print(f"⚠️ Skipped summary {fn}: {e}")

        # --- QnA ---
        if os.path.isdir(qna_dir):
            for fn in os.listdir(qna_dir):
                if not fn.endswith(".json"):
                    continue

                qna_path = os.path.join(qna_dir, fn)
                try:
                    with open(qna_path, "r", encoding="utf-8") as f:
                        data = json.load(f)
                except Exception as e:
                    print(f"⚠️ Skipped malformed QnA file {fn}: {e}")
                    continue

                # Handle if data is not a dict
                if not isinstance(data, dict):
                    print(f"⚠️ Skipped {fn}: invalid JSON structure (not a dict)")
                    continue

                qs = data.get("questions", [])
                if not isinstance(qs, list):
                    continue

                for qa in qs:
                    try:
                        if not isinstance(qa, dict):
                            continue
                        q = qa.get("question", "")
                        a = qa.get("answer", "")
                        if not q or not a:
                            continue
                        prompt = (
                            "Answer the following question in the same language as the dialogue:\n"
                            f"Question: {q}\nAnswer:"
                        )
                        examples.append({"text": prompt, "labels": a})
                    except Exception as e:
                        print(f"⚠️ Skipped malformed QA entry in {fn}: {e}")
                        continue

    print(f"✅ Loaded {len(examples)} examples from {root}")
    return examples
