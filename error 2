if safe_ckpt:
    print(f"🔄 Found checkpoint folder: {safe_ckpt}")
    trainer_state_path = os.path.join(safe_ckpt, "trainer_state.json")

    if os.path.exists(trainer_state_path):
        # Full Trainer checkpoint (rare in this setup)
        print("🧠 Full checkpoint detected — resuming complete training state...")
        trainer.train(resume_from_checkpoint=safe_ckpt)
    else:
        # Only adapter weights exist
        print("⚠️ No trainer_state.json found — loading adapter weights only.")
        model = PeftModel.from_pretrained(model, safe_ckpt)
        trainer.model = model
        print("🔁 Continuing training from adapter weights...")
        trainer.train()
else:
    print("✨ Starting fresh training...")
    trainer.train()
