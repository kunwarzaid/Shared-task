\begin{figure}[ht]
\centering
\begin{tikzpicture}[node distance=2cm, auto, thick, >=stealth, font=\small]
\tikzstyle{agent}=[rectangle, rounded corners, draw=black!70, fill=blue!5, text width=3.6cm, text centered, minimum height=1.2cm]
\tikzstyle{process}=[rectangle, rounded corners, draw=black!70, fill=green!5, text width=3.4cm, text centered, minimum height=1.0cm]
\tikzstyle{log}=[rectangle, rounded corners, draw=black!70, fill=yellow!10, text width=4.5cm, text centered, minimum height=1.0cm]

% Agents
\node[agent] (doctor) {Doctor Agent \\ (Reasoning, Requests Tests)};
\node[agent, below of=doctor, yshift=-0.2cm] (patient) {Patient Agent \\ (Responds to Queries)};
\node[agent, right of=doctor, xshift=4.5cm] (measure) {Measurement Agent \\ (Provides Test Results)};
\node[agent, below of=measure, yshift=-0.2cm] (safety) {Safety Agent \\ (Evaluates Prescriptions \& Tests)};

% Logging Layer
\node[log, below of=patient, yshift=-1.2cm, xshift=2.25cm] (logger) {Explainability \& Logging Layer \\ \textit{(Timestamps, Actor, Event Type, Reasoning Trace)}};

% Arrows between agents
\draw[->, thick] (doctor) -- node[midway, left]{Question / Request} (patient);
\draw[->, thick] (patient) -- node[midway, right]{Answer / Symptom Info} (doctor);
\draw[->, thick] (doctor) -- node[midway, above]{REQUEST TEST} (measure);
\draw[->, thick] (measure) -- node[midway, below]{Test Result} (doctor);
\draw[->, thick] (doctor) -- node[midway, above]{Prescription} (safety);
\draw[->, thick] (safety) -- node[midway, below]{Safety Verdict} (doctor);

% Logging arrows
\draw[->, dashed, gray!80] (doctor) -- (logger);
\draw[->, dashed, gray!80] (patient) -- (logger);
\draw[->, dashed, gray!80] (measure) -- (logger);
\draw[->, dashed, gray!80] (safety) -- (logger);

% Caption text
\node[process, below of=logger, yshift=-1cm, xshift=0cm, text width=9cm] (explain) {
Logs are aggregated chronologically to reconstruct the full reasoning graph, enabling
post-hoc explainability, safety auditing, and trust analysis.
};

\end{tikzpicture}
\caption{Architecture of the MedGuard-X explainability and logging system. 
All agent interactions (Doctor, Patient, Measurement, Safety) are recorded 
as timestamped log events containing actor type, reasoning trace, and context.
These logs form a transparent audit trail for reconstructing and interpreting the modelâ€™s diagnostic reasoning.}
\label{fig:logging-architecture}
\end{figure}
