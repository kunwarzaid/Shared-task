\begin{figure*}[t]
\centering
\resizebox{\textwidth}{!}{%
% ---- (insert TikZ code here) ----
}
\caption{MedGuard-X architecture...}
\label{fig:medguardx-architecture}
\end{figure*}


\begin{figure}[t]
\centering
\begin{tikzpicture}[node distance=12mm, >=latex, thick, font=\small]

% Styles
\tikzstyle{agent}=[rectangle, rounded corners, draw=black!70, fill=blue!5,
                   minimum width=4.0cm, minimum height=1.15cm, align=center]
\tikzstyle{layer}=[rectangle, rounded corners, draw=black!70, fill=yellow!10,
                   minimum width=9.6cm, minimum height=1.15cm, align=center]
\tikzstyle{store}=[rectangle, rounded corners, draw=black!70, fill=green!5,
                   minimum width=5.2cm, minimum height=1.0cm, align=center]

% Top row (Doctor, Measurement)
\node[agent] (doctor) {Doctor Agent\\\scriptsize Reasoning, DDx, Orders};
\node[agent, right=28mm of doctor] (measure) {Measurement Agent\\\scriptsize Tests, Results, Ground Truth};

% Second row (Patient, Safety)
\node[agent, below=16mm of doctor] (patient) {Patient Agent\\\scriptsize Case-grounded Responses};
\node[agent, below=16mm of measure] (safety) {Safety Agents\\\scriptsize Test Risk \& Rx Safety (DDI)};

% Logging layer
\node[layer, below=18mm of $(patient)!0.5!(safety)$] (logger)
{Explainability \& Logging Layer: timestamps, actor, event, \texttt{<thinking\_process>}, context hashes};

% Storage + Metrics
\node[store, below left=10mm and 6mm of logger] (trace)
{Trace Store \& Replay API\\\scriptsize Chronological reasoning ledger, audit trails};
\node[store, below right=10mm and 6mm of logger] (metrics)
{Trust Metrics\\\scriptsize CDR, Justification Alignment, Timeout Rate, Unsafe-Rx Rate};

% Arrows: Doctor ↔ Patient
\draw[->] (doctor.south) -- node[left,pos=0.5]{\scriptsize Question} (patient.north);
\draw[->] (patient.north) -- node[right,pos=0.52]{\scriptsize Answer} (doctor.south);

% Arrows: Doctor ↔ Measurement
\draw[->] (doctor.east) -- node[above,pos=0.55]{\scriptsize REQUEST TEST} (measure.west);
\draw[->] (measure.west) -- node[below,pos=0.45]{\scriptsize Test Result} (doctor.east);

% Arrows: Doctor ↔ Safety
\draw[->] (doctor.south east) to[bend left=8] node[right,pos=0.5]{\scriptsize Prescription} (safety.north);
\draw[->] (safety.north) to[bend left=8] node[left,pos=0.5]{\scriptsize Safety Verdict} (doctor.south east);

% Logging taps (dashed feel via gray arrows)
\draw[->,gray!70] (doctor.south) ++(0,-2mm) -- (logger.north -| doctor);
\draw[->,gray!70] (patient.south) -- (logger.north -| patient);
\draw[->,gray!70] (measure.south) -- (logger.north -| measure);
\draw[->,gray!70] (safety.south) -- (logger.north -| safety);

% From logging to storage/metrics
\draw[->,black!70] (logger.south) -- node[left]{\scriptsize persist} (trace.north);
\draw[->,black!70] (logger.south) -- node[right]{\scriptsize compute} (metrics.north);

\end{tikzpicture}
\caption{MedGuard-X architecture. Doctor interacts with Patient and Measurement Agents to gather evidence, maintains an evolving differential diagnosis, and consults Safety Agents for test and prescription risk (including DDI). All agent actions stream structured events (with \texttt{<thinking\_process>} snippets) to a logging layer that supports replay, auditing, and trust metrics (e.g., Consensus Disagreement Rate, Justification Alignment).}
\label{fig:medguardx-architecture}
\end{figure}
